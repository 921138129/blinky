# Blinky

<img src="readme-img/blinky-rocket.png" align="right" width="220px"/>

Blinky is the ultimate experiment for wide-angle video (180º-360º) in gaming.
It uses the game Quake to explore how to _capture_ a panorama of the
environment (__Globes__) and how to _project_ its image to the screen
(__Lenses__).  We explore the rich space of projections found in Cartography
and Panoramic Photography and offer visual aid for analyzing their shape.

[>> Watch the video](http://youtu.be/jQOJ3yCK8pI)

- continues the work of [Fisheye Quake](http://strlen.com/gfxengine/fisheyequake/)
- adds a Lua scripting environment for defining custom Lenses and Globes
- includes the Quake demo as a free testing sandbox
- uses the cross-platform [TyrQuake engine](http://disenchant.net/tyrquake/)

For example, the common projection below on the left is poorly suited for
wide-angle video.  But using the Panini projection on the right allows us to
see wider angles with little distortion and can keep vertical lines unlike a
standard fisheye (e.g. GoPro).

![old-and-new](readme-img/old-and-new.jpg)

## Play!

<img src="readme-img/windows.png" height="16px"> __Windows__ users, download [blinky-1.2-windows.zip](https://github.com/shaunlebron/blinky/releases/download/1.2/blinky-1.2-windows.zip)

<img src="readme-img/apple.png"   height="16px"> __Mac__ users, please build/run from source:

```sh
$ brew install lua
$ brew install sdl2
$ ./build.sh
$ ./play.sh
```

<img src="readme-img/linux.png"   height="16px"> __Linux__ users, please build/run from source:

```sh
$ sudo apt-get install lua
$ sudo apt-get install libsdl2-dev
$ ./build.sh
$ ./play.sh
```

### Walkthrough

When you first start the game, you will already be viewing the most practical,
wide angle lens-- Panini with 180º horizontal FOV.

![keys](readme-img/keys.png)

TODO: write more

## Command reference

```sh
fisheye <0|1>     # enable/disable fisheye mode
f_help            # show quick start options
f_globe <name>    # choose a globe (affects picture quality and render speed)
f_lens <name>     # choose a lens (affects the shape of your view)
f_fov <degrees>   # zoom to a horizontal FOV
f_vfov <degrees>  # zoom to a vertical FOV
f_cover           # zoom in until screen is covered (some parts may be hidden)
f_contain         # zoom out until screen contains the entire image (if possible)
f_rubix           # display colored grid for each rendered view in the globe
f_saveglobe       # take screenshots of each globe face (environment map)
```

## Conclusions

- Use Standard projection for FOV ≤ 110º.  Anything more leads to increasing distortion.
- Use Panini projection for FOV ≤ 200º.  Very practical, wide motion lens with low distortion.
- No preferences for FOV ≤ 360º.  They are more aesthetic than practical.

## How does it work?

View construction happens in two stages:

1. Capture surrounding pixels with multiple camera shots. (via __Globe__ script)
1. Stitch the shots together on the screen to get a hyper-wide FOV. (via __Lens__ script)

Your view can be customized by swapping each script out for another; choose
from several presets or even create your own.

__NOTE__: See the beginning of `NQ/fisheye.c` for extensive documentation and
diagrams describing the fisheye process in detail.


## Code Navigation

__NOTE__: See the beginning of `fisheye.c` for extensive documentation and
diagrams describing the fisheye process in detail.

If you wish to see the engine modifications that made this possible, see the
[engine patch](engine/fisheye.patch), generated by:

```
git diff 23119f4eb2ac6b5cef3e1ebfc785189b011aae26.. NQ common include Makefile
```

The meat of the work is done by the following files, which are completely
new additions to the engine:

- engine/NQ/fisheye.c
- engine/include/fisheye.h
- lua/lenses/*.lua
- lua/globes/*.lua

[Panini]: http://tksharpless.net/vedutismo/Pannini/
